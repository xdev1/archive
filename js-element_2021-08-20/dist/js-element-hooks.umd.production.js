!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("js-element/core")):"function"==typeof define&&define.amd?define(["exports","js-element/core"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).jsElement={},e.jsElement.core)}(this,(function(e,t){"use strict";var n=new WeakMap,r=Symbol("iteration key");function o(e,t,n){var r=t.get(n);r&&r.forEach(e.add,e)}function a(e){e.delete(this)}var u=[],s=!1;function c(e,t,n,r){if(e.unobserved)return Reflect.apply(t,n,r);if(-1===u.indexOf(e)){!function(e){e.cleaners&&e.cleaners.forEach(a,e),e.cleaners=[]}(e);try{return u.push(e),Reflect.apply(t,n,r)}finally{u.pop()}}}function i(e){var t=u[u.length-1];t&&(p(t,e),function(e,t){var o=t.target,a=t.key;"iterate"===t.type&&(a=r);var u=n.get(o),s=u.get(a);s||(s=new Set,u.set(a,s)),s.has(e)||(s.add(e),e.cleaners.push(s))}(t,e))}function f(e){(function(e){var t=e.target,a=e.key,u=e.type,s=n.get(t),c=new Set;if("clear"===u?s.forEach((function(e,t){o(c,s,t)})):o(c,s,a),"add"===u||"delete"===u||"clear"===u){var i=Array.isArray(t)?"length":r;o(c,s,i)}return c})(e).forEach(l,e)}function l(e){p(e,this),"function"==typeof e.scheduler?e.scheduler(e):"object"==typeof e.scheduler?e.scheduler.add(e):e()}function p(e,t){if(e.debugger&&!s)try{s=!0,e.debugger(t)}finally{s=!1}}function y(){return u.length>0}var d=Symbol("is reaction");var g=new WeakMap,h=new WeakMap,v=Object.prototype.hasOwnProperty;function b(e){var t=h.get(e);return y()&&"object"==typeof e&&null!==e?t||P(e):t||e}function m(e,t){var n=e.next;return e.next=function(){var r=n.call(e),o=r.done,a=r.value;return o||(t?a[1]=b(a[1]):a=b(a)),{done:o,value:a}},e}var k={has:function(e){var t=g.get(this),n=Reflect.getPrototypeOf(this);return i({target:t,key:e,type:"has"}),n.has.apply(t,arguments)},get:function(e){var t=g.get(this),n=Reflect.getPrototypeOf(this);return i({target:t,key:e,type:"get"}),b(n.get.apply(t,arguments))},add:function(e){var t=g.get(this),n=Reflect.getPrototypeOf(this),r=n.has.call(t,e),o=n.add.apply(t,arguments);return r||f({target:t,key:e,value:e,type:"add"}),o},set:function(e,t){var n=g.get(this),r=Reflect.getPrototypeOf(this),o=r.has.call(n,e),a=r.get.call(n,e),u=r.set.apply(n,arguments);return o?t!==a&&f({target:n,key:e,value:t,oldValue:a,type:"set"}):f({target:n,key:e,value:t,type:"add"}),u},delete:function(e){var t=g.get(this),n=Reflect.getPrototypeOf(this),r=n.has.call(t,e),o=n.get?n.get.call(t,e):void 0,a=n.delete.apply(t,arguments);return r&&f({target:t,key:e,oldValue:o,type:"delete"}),a},clear:function(){var e=g.get(this),t=Reflect.getPrototypeOf(this),n=0!==e.size,r=e instanceof Map?new Map(e):new Set(e),o=t.clear.apply(e,arguments);return n&&f({target:e,oldTarget:r,type:"clear"}),o},forEach:function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var r=g.get(this),o=Reflect.getPrototypeOf(this);i({target:r,type:"iterate"});var a,u=function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e.apply(void 0,[b(t)].concat(n))};return(a=o.forEach).call.apply(a,[r,u].concat(t))},keys:function(){var e=g.get(this),t=Reflect.getPrototypeOf(this);return i({target:e,type:"iterate"}),t.keys.apply(e,arguments)},values:function(){var e=g.get(this),t=Reflect.getPrototypeOf(this);i({target:e,type:"iterate"});var n=t.values.apply(e,arguments);return m(n,!1)},entries:function(){var e=g.get(this),t=Reflect.getPrototypeOf(this);i({target:e,type:"iterate"});var n=t.entries.apply(e,arguments);return m(n,!0)},get size(){var e=g.get(this),t=Reflect.getPrototypeOf(this);return i({target:e,type:"iterate"}),Reflect.get(t,"size",e)}};k[Symbol.iterator]=function(){var e=g.get(this),t=Reflect.getPrototypeOf(this);i({target:e,type:"iterate"});var n=t[Symbol.iterator].apply(e,arguments);return m(n,e instanceof Map)};var w={get:function(e,t,n){return e=v.call(k,t)?k:e,Reflect.get(e,t,n)}},O="object"==typeof window?window:Function("return this")(),S=new Map([[Map,w],[Set,w],[WeakMap,w],[WeakSet,w],[Object,!1],[Array,!1],[Int8Array,!1],[Uint8Array,!1],[Uint8ClampedArray,!1],[Int16Array,!1],[Uint16Array,!1],[Int32Array,!1],[Uint32Array,!1],[Float32Array,!1],[Float64Array,!1]]);function j(e){return S.get(e.constructor)}var E=Object.prototype.hasOwnProperty,M=new Set(Object.getOwnPropertyNames(Symbol).map((function(e){return Symbol[e]})).filter((function(e){return"symbol"==typeof e})));var R={get:function(e,t,n){var r=Reflect.get(e,t,n);if("symbol"==typeof t&&M.has(t))return r;i({target:e,key:t,receiver:n,type:"get"});var o=h.get(r);if(y()&&"object"==typeof r&&null!==r){if(o)return o;var a=Reflect.getOwnPropertyDescriptor(e,t);if(!a||!1!==a.writable||!1!==a.configurable)return P(r)}return o||r},has:function(e,t){var n=Reflect.has(e,t);return i({target:e,key:t,type:"has"}),n},ownKeys:function(e){return i({target:e,type:"iterate"}),Reflect.ownKeys(e)},set:function(e,t,n,r){"object"==typeof n&&null!==n&&(n=g.get(n)||n);var o=E.call(e,t),a=e[t],u=Reflect.set(e,t,n,r);return e!==g.get(r)||(o?n!==a&&f({target:e,key:t,value:n,oldValue:a,receiver:r,type:"set"}):f({target:e,key:t,value:n,receiver:r,type:"add"})),u},deleteProperty:function(e,t){var n=E.call(e,t),r=e[t],o=Reflect.deleteProperty(e,t);return n&&f({target:e,key:t,oldValue:r,type:"delete"}),o}};function P(e){return void 0===e&&(e={}),g.has(e)||"function"==typeof(t=e.constructor)&&t.name in O&&O[t.name]===t&&!S.has(t)?e:h.get(e)||function(e){var t=j(e)||R,r=new Proxy(e,t);return h.set(e,r),g.set(r,e),function(e){n.set(e,new Map)}(e),r}(e);var t}const U="js-element::ext::store";let A=!1,x=!1,H=null;function C(e,n){return A||(t.intercept("init",((e,t)=>{H=e;try{t()}finally{H=null}})),A=!0),(...t)=>{if(!H)throw new Error(`Hook function "${e}" has been invoked outside of component initialization phase`);return n(...t)}}function I(e){const t=H,n=t.getHost();let r=null;const o=new Promise((e=>{r=()=>e(null)}));let a=e.defaultValue;return t.beforeMount((()=>{const r={context:e,callback:e=>{a=e,t.refresh()},cancelled:o};n.dispatchEvent(new CustomEvent("$$context$$",{detail:r,bubbles:!0,composed:!0}))})),t.beforeUnmount((()=>r())),()=>a}const T=C("useCtx",(function(e){if(e&&"context"===e.kind)return I(e);const t={};return Object.entries(e).forEach((([n,r])=>{Object.defineProperty(t,n,{get:"context"===r.kind?I(r):e[n]})})),t}));const V=C("useHost",(()=>H.getHost())),$=C("useMethods",((e,t)=>{e&&t&&(e.current=t)})),B=C("useRefresher",(function(){return H.refresh})),z=C("useStatus",(function(){const e=H;return{isMounted:e.isMounted,hasUpdated:e.hasUpdated}})),W=C("useDefaults",(function(e,t){const n=H,r=Object.assign({},t,e);return n.beforeUpdate((()=>{for(const e in r)delete r[e];Object.assign(r,t,e)})),r})),D=C("useValue",(function(e){let t=e,n=e;const r=H;return[()=>n,e=>{t="function"==typeof e?e(t):e,r.onceBeforeUpdate((()=>{n=t})),r.refresh()}]})),N=C("useState",(function(e){let t,n=!1;const r=H,o={...e};return t={...o},[o,(e,a)=>{n=!0,"string"==typeof e?t[e]="function"==typeof a?a(t[e]):a:"function"==typeof e?Object.assign(t,e(t)):Object.assign(t,e),r.onceBeforeUpdate((()=>{n&&(Object.assign(o,t),n=!1)})),r.refresh()}]})),F=C("useReactive",(function(e){return x||(t.intercept("render",((e,t)=>{!function(e,t){void 0===t&&(t={});var n=e[d]?e:function t(){return c(t,e,this,arguments)};n.scheduler=t.scheduler,n.debugger=t.debugger,n[d]=!0,t.lazy||n()}(t)})),x=!0),n=e,g.has(n)?e:P(e);var n}));const L=C("useStyles",((...e)=>{const t=H,n=(...e)=>{!function(e,t){if(t instanceof HTMLStyleElement)e.appendChild(t);else{const n=t.join("\n\n/* =============== */\n\n"),r=document.createElement("style");r.appendChild(document.createTextNode(n)),e.appendChild(r)}}(t.getHost().shadowRoot.firstChild,e)};return n.apply(null,e),n})),K=C("useEmitter",(function(){const e=H.getHost();return(t,n)=>{e.dispatchEvent(t),n&&n(t)}})),_=C("useMemo",(function(e,t){let n,r;return{get value(){const o=t();return n&&ae(n,o)||(r=e.apply(null,o)),n=o,r}}})),q=C("useAfterMount",(function(e){let t;const n=H;n.afterMount((()=>{t=e()})),n.beforeUnmount((()=>{"function"==typeof t&&t(),t=null}))})),G=C("useBeforeUpdate",(function(e){let t;const n=H;n.beforeMount((()=>{t=e()})),n.afterUpdate((()=>{"function"==typeof t&&t()})),n.beforeUnmount((()=>{"function"==typeof t&&t(),t=null}))})),J=C("useAfterUpdate",(function(e){let t;const n=H;n.afterUpdate((()=>{"function"==typeof t&&t(),t=e()})),n.beforeUnmount((()=>{"function"==typeof t&&t(),t=null}))})),Q=C("useBeforeUnmount",(function(e){H.beforeUnmount(e)})),X=C("useEffect",(function(e,t){let n,r=null;const o=H,a=()=>{let o=void 0===t;if(!o){const e=t();o=null===r||null===e||!ae(r,e),r=e}o&&(n&&n(),n=e())};o.afterMount(a),o.afterUpdate(a),o.beforeUnmount((()=>n&&n()))})),Y=C("useInterval",((e,t)=>{const n="function"==typeof t?t:()=>t;X((()=>{const t=setInterval(e,n());return()=>clearInterval(t)}),(()=>[n()]))})),Z=C("useTimer",((e,t=ee)=>{let n=0;const r="function"==typeof e?e:()=>e,[o,a]=D(t(n++));return Y((()=>{a(t(n++))}),(()=>r())),o}));function ee(){return new Date}const te={result:void 0,error:void 0,state:"pending"},ne=C("usePromise",(function(e,t){const[n,r]=N(te);let o=-1;return X((()=>{++o,"pending"!==n.state&&r(te);const t=o;e().then((e=>{o===t&&r({result:e,state:"resolved"})})).catch((e=>{o===t&&r({error:e instanceof Error?e:new Error(String(e)),state:"rejected"})}))}),"function"==typeof t?t:()=>[]),{getState:()=>n.state,getResult:()=>n.result,getError:()=>n.error}})),re=C("useActions",(function(e){let t=null;const n=H,r={};n.beforeMount((()=>{if(se(n,{type:U,payload:{setStore(e){t=e}}}),!t)throw new Error(`Store for actions not available (-> ${n.getName()})`)}));for(const n of Object.keys(e))r[n]=(...r)=>{t.dispatch(e[n](...r))};return r}));let oe=0;function ae(e,t){let n=Array.isArray(e)&&Array.isArray(t)&&e.length===t.length;if(n)for(let r=0;r<e.length;++r)if(e[r]!==t[r]){n=!1;break}return n}const ue="js-element/hooks::send+receive";function se(e,t){e.getHost().dispatchEvent(new CustomEvent(ue+t.type,{bubbles:!0,composed:!0,detail:t}))}function ce(e,t,n){const r=e.getHost(),o=e=>{e.stopPropagation(),n(e.detail)},a=()=>{r.removeEventListener(ue+t,o)};return r.addEventListener(ue+t,o),e.beforeUnmount(a),a}e.createStoreHook=function(e){return()=>{const t={},n=B();for(const n of Object.keys(e.getState()))Object.defineProperty(t,n,{get:()=>e.getState()[n]});return q((()=>e.subscribe((()=>{n()})))),t}},e.createStoreHooks=function(){const e=U+ ++oe;return[C("useStore",(t=>{const n=H;n.beforeMount((()=>{ce(n,U,(e=>{e.payload.setStore(t)})),ce(n,e,(e=>{e.payload.setStore(t)}))}))})),C("useSelectors",(function(t){let n=null;const r=H,o={};r.beforeMount((()=>{if(se(r,{type:e,payload:{setStore(e){n=e}}}),!n)throw new Error(`Store for selectors not available (-> ${r.getName()})`);const t=n.subscribe((()=>{r.refresh()}));r.beforeUnmount(t)}));for(const e of Object.keys(t))Object.defineProperty(o,e,{get:()=>t[e](n.getState())});return o}))]},e.hook=C,e.useActions=re,e.useAfterMount=q,e.useAfterUpdate=J,e.useBeforeMount=G,e.useBeforeUnmount=Q,e.useCtx=T,e.useDefaults=W,e.useEffect=X,e.useEmitter=K,e.useHost=V,e.useInterval=Y,e.useMemo=_,e.useMethods=$,e.usePromise=ne,e.useReactive=F,e.useRefresher=B,e.useState=N,e.useStatus=z,e.useStyles=L,e.useTimer=Z,e.useValue=D,Object.defineProperty(e,"__esModule",{value:!0})}));
